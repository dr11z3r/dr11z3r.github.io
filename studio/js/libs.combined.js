!function(){let e={version:1,uid:0,skippable:[],skipCallback:null,timeout:0,toCursor:0,done:()=>!0,skip:function(){return!!e.skippable.length&&(e.transition&&(e.transition=null),e.skippable.pop()[1](),!0)},skipByUID:function(t){let n=e.skippable.findIndex(e=>e[0]===t);return-1!==n&&(e.skippable.splice(n,1)[1](),!0)},readyMedia:{},assetsLoaded:0,preloadMediaStepIndex:0,preloadMediaStep:function(){},preloadMedia:function(t){e.readyMedia[t]||(e.readyMedia[t]=function(){if(t.match(/\.(mp4|webm)$/i)){var n=document.createElement("video");return n.onerror=(()=>{e.preloadMediaStep()}),n.preload="metadata",n.src=t,n.load(),n.readyState>=n.HAVE_FUTURE_DATA?(e.assetsLoaded++,e.preloadMediaStep()):n.addEventListener("canplay",()=>{e.assetsLoaded++,e.preloadMediaStep()},!1),n}if(t.match(/\.(jpeg|jpg|gif|png|webp)$/i)){var i=new Image;return i.onload=(()=>{e.assetsLoaded++,e.preloadMediaStep()}),i.onerror=(()=>{e.assetsLoaded++,e.preloadMediaStep()}),i.src=t,i}return console.log("wat %s",t),null}())}};e.progressInterval=setInterval(()=>{if(!e.progressIntervalPaused)if(e.timeout>0&&e.timeout>e.toCursor){var t=$("#timeout");t.length&&(e.toCursor+=100,t.show(),$(".tol").css({display:"inline-block",width:100-e.toCursor/e.timeout*100+"%"}),e.transition&&e.toCursor>2e3&&!e._fadeOutOnce&&e.timeout-e.toCursor<=500&&(e._fadeOutOnce=!0,$(".video-container>video").fadeOut(e.timeout-e.toCursor),e.transition="fadeIn",console.log("fading out")))}else $(".tol").css({width:"100%",display:"none"}),e.toCursor=0,e.timeout=0},100),e.setProgressTimeout=function(t){"boolean"!=typeof t?(this.toCursor=0,this.timeout=t,this.timeout>0&&(tol=$("#timeout"),tol.length||$("body").append('<div id="timeout"><div class="tol">&nbsp;</div></div>'))):e.progressIntervalPaused=t},e.escapeHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=\/]/g,function(e){return t[e]})},e.getGrid=function(){var t=document.getElementById("grid");if(!t)return null;for(var n={},i=0,a=0;a<e.gridparams.cols;a++)for(var r=0;r<e.gridparams.rows;r++)n[a+"_"+r]={img:t.querySelector("#grid_i"+i),bge:t.querySelector("#grid_ic"+i),vid:t.querySelector("#grid_ivc"+i),fx:t.querySelector("#grid_ifx"+i)},i++;return{grid:t,rows:e.gridparams.rows,cols:e.gridparams.cols,values:n}},e.setGrid=function(t,n){var i=document.getElementById("grid");e.gridparams={rows:t,cols:n},i||((i=document.createElement("div")).id="grid",i.setAttribute("style","position:fixed;width:100%;height:100%;top:0;left:0;"),document.body.appendChild(i));for(var a=n*t,r=100/n,s=100/t,o="",d=0;d<a;d++){o+='<div style="float:left;width:'+r+"%;height:"+s+'%" data-index='+d+' class="card-container"><div class="bgfx" id="grid_ic'+d+'"></div>'+('<div class="video-container" id="grid_ivc'+d+'"></div><div class="ifx" id="grid_ifx'+d+'"></div>')+'<img id="grid_i'+d+'" /></div>'}i.innerHTML=o},e.setGridFx=function(e,t){var n=document.getElementById("grid");n&&("string"==typeof t?n.querySelector("#grid_ifx"+e).innerHTML=t:$("#grid_ifx"+e).append(t))},e.addGridVideoQueue=function(e,t,n){var i=document.getElementById("grid");if(i){var a=i.querySelector("#grid_ivc"+e);if(a){var r=a.getElementsByTagName("video")[0];if(r){if(null===t&&"reset"===n)return r._queue=null,void delete r._queueIndex;r._queue||(r._queue=[],r._queueIndex=0);let i=document.createElement("video");i.setAttribute("data-vidi",e),i.style.cssText=r._style,i.autoplay=!0,i.src=t,i.load(),i.style.display="none",console.log("push %s to vid index %d",t,e),r._queue.push([t,n,i]),a.appendChild(i)}}}},e.setGridVideo=function(t,n,i,a="adjust",r,s=!0,o=!0,d=0,p=!0,l=1){var u=document.getElementById("grid");if(u){var c=u.querySelector("#grid_i"+t),m=u.querySelector("#grid_ic"+t),g=u.querySelector("#grid_ivc"+t);if(c){var f="";switch(a){case"fill":f="min-width: 100%;min-height: 100%; width: auto;height: auto;position: absolute;top: 50%;left: 50%;transform: translate(-50%,-50%);",g.setAttribute("style","position: absolute;top:0;bottom:0;width:100%;height:100%;overflow:hidden");break;case"fullWidth":f="width:100%;",g.setAttribute("style","width:100%;max-width:100%;min-height:25%;position:relative;");break;case"fullHeight":f="height:100%;",g.setAttribute("style","height:100%;max-width:100%;min-height:25%;position:relative;");break;case"adjust":f="max-height:100%;max-width:100%;height:auto;position: absolute;top: 50%; transform: translate(-50%, -50%);";break;case"topAdjust":f="width:100%",g.setAttribute("style","width:auto;max-width:100%;max-height:100%;min-height:25%;position:relative;")}$(c).fadeOut(1e3);var h=n;if(g.getElementsByTagName("video")[0]){let e=g.getElementsByTagName("video")[0],n=!1;e._queue&&(console.log("cleaning grid index queue because soft swapping!"),g._queue=[],g._queueIndex=0,n=!0);let i=Math.floor(Math.random()*Date.now()),r=$('<video data-uniqid="'+i+'" data-vidi="'+t+'" style="'+f+'" autoplay><source src="'+h+'">'+(h.match("i.imgur.com")?'<source src="'+h.replace(".webm",".mp4")+'">':"")+"</video>");r[0].volume=l,g.appendChild(r[0]),n?$(g).find("video").each(function(){if($(this).data("uniqid")!==i){$(this).addClass("tainted");let e=this;requestAnimationFrame(()=>{"fill"!==a&&$(e).animate({opacity:.1},500)})}}):($(e).addClass("tainted"),requestAnimationFrame(()=>{"fill"!==a&&$(e).animate({opacity:.1},500)})),setTimeout(()=>{n?$(g).find("video").each(function(){$(this).data("uniqid")!==i&&$(this).remove()}):$(e).remove()},150+100*Math.random())}else g.innerHTML='<video data-vidi="'+t+'" style="'+f+'" autoplay><source src="'+h+'">'+(h.match("i.imgur.com")?'<source src="'+h.replace(".webm",".mp4")+'">':"")+"</video>",g.style.display="";var v=$(g).find("video:not(.tainted)")[0];v._style=f,v.currentTime=d,v.volume=l,v._onended=(()=>{if(r&&r(t),v._queue&&null!=v._queueIndex){let e=v._queue[v._queueIndex++%v._queue.length];if(v.src.endsWith(e[0]))v.play();else{if(v._ref&&v._ref.busy)return console.log("busy");v._ref&&(v._ref.busy=!0);let n=v;(v=e[2])._onended||(v._onended=n._onended,v._ref=n._ref||n,v._ref.busy=!0,v.addEventListener("ended",v._onended)),e[1]&&(m.style.background="url("+e[1]+")"),v._queue=n._queue,v._queueIndex=n._queueIndex,v.currentTime=0,v.play(),console.log("applying queue for video %d (%s)",t,v.src),n.currentTime=0,n.pause(),n.style.display="none",v.style.display="",v._ref&&(v._ref.busy=!1)}}else p&&v.play()}),v.addEventListener("ended",v._onended),i&&(m.style.background="url("+i+")",s&&(m.style.backgroundPosition="0 50%"),"fill"===s&&(m.style.backgroundSize="100% 100%"),m.style.filter=o?"blur(5px)":""),"fadeIn"===e.transition&&(e.transition=null,console.log("fading in"),$(v).finish().fadeOut(0),requestAnimationFrame(()=>{e._fadeOutOnce=!0,$(v).finish().fadeIn(1e3),setTimeout(()=>{e._fadeOutOnce=!1},1e3)}))}}},e.setGridImage=function(e,t,n,i="adjust",a=!0,r=!0){"same"==n&&(n=t);var s=document.getElementById("grid");if(s){var o=s.querySelector("#grid_i"+e),d=s.querySelector("#grid_ic"+e),p=s.querySelector("#grid_ivc"+e);if(o){switch(i){case"vertical":o.setAttribute("style","width:auto;height:100%;position:relative;left:100%;margin-left:-200%");break;case"horizontal":o.setAttribute("style","width:100%;height:auto;position:relative;top:100%;margin-top:-200%");break;case"adjust":o.setAttribute("style","max-height:100%;max-width:100%;width:auto;height:auto;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;");break;case"topAdjust":o.setAttribute("style","width:auto;max-width:100%;max-height:100%;min-height:25%;position:relative;");break;case"fill":o.setAttribute("style","max-height:100%;max-width:100%;min-width:100%;min-height:100%;width:auto;height:auto;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;");break;case"fillVertical":o.setAttribute("style","max-width:100%;min-width:100%;min-height:100%;width:auto;height:auto;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;");break;case"fillHorizontal":o.setAttribute("style","max-height:100%;min-width:100%;min-height:100%;width:auto;height:auto;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;")}o.style.display="",p.innerHTML="",p.style.display="none",n&&(d.style.background="url("+n+")",a&&(d.style.backgroundPosition="0 50%"),d.style.filter=r?"blur(5px)":""),o.src=t}}},e.ghost=function(e,t=1850,n=null){var i=document.getElementById("grid"),a=$(i.querySelector("#grid_i"+e)),r=a.clone();n&&r.attr("src",n);var s=$('<div style="transition: '+t/1e3+'s ease-out" class="overlay'+(n?"-fx":"")+'"></div>');s.append(r),a.parent().append(s),setTimeout(()=>s.addClass("active"),100),setTimeout(()=>{r.remove(),s.remove()},t+1e3)},e.play=function(e,t){var n=new Audio(e);n.loop=t||!1,n.play()},e.appendToGrid=function(e,t){var n=document.getElementById("grid");(e=$(n.querySelector("#grid_ifx"+e))).append(t)},e.popSkippable=function(e){if(!this.skippable.length)throw new Error("invalid popSkippable call!");for(var t=0;t<this.skippable.length;t++)if(this.skippable[0]===e)return this.skippable.splice(t,1),!0;return!1},e.setSkippable=function(e,t){this.skippable.push([e,()=>{t()}])},TimelineCompiler.LIB.PMV=function(){let t=document.getElementById("_pmvstyle");return t||((t=document.createElement("style")).innerText=".bgfx{\n                float:left;\n                width:100%;\n                height:100%;\n                z-index:0;\n                position:absolute\n            }\n            .ifx{\n                float:left;\n                width:100%;\n                height:100%;\n                z-index:127;\n                position:absolute\n            }\n            .card-container{\n                text-align:center;\n                overflow:hidden;\n                height:100%;\n                position:relative;\n                background:transparent\n            }\n            .card-container>img{\n                border:none;\n                filter: none;\n            }\n            .card{\n                height:100%\n            }\n            .overlay-fx {\n                position: absolute;\n                top:0;\n                background-color:transparent;\n                overflow: hidden;\n                width: 100%;\n                height: 100%;\n                transform:scale(0.1);\n                opacity:0.5;\n            }\n            .overlay {\n                position: absolute;\n                top:0;\n                background-color:transparent;\n                overflow: hidden;\n                width: 100%;\n                height: 100%;\n                transform:scale(1);\n                opacity:0.5;\n            }\n            \n            .overlay.active, .overlay-fx.active {\n                transform: scale(2.5);\n                opacity: 0;\n            }\n            .active-2x {\n                transform: scale(1.15);\n                opacity: 1;\n            }\n            #timeout {\n                position:fixed;\n                height:9px;\n                width:100%;\n                top:0;\n                left:0;\n                text-align: center;\n                z-index:9999999;\n            }\n            .tol {\n                background:rgba(255,255,255,0.85);\n                height:100%;\n                display: inline-block;\n                transition: width linear 0.11s;\n            }\n            ",document.body.appendChild(t)),addEventListener("keydown",t=>{32===t.keyCode&&e.skip()}),window.app=e,"\ncmdg PMV {\n    if (!('app' in window)) throw new Error('app instance not found!');\n    state.scope.pmv = {};\n    state.scope.pmv.song = null;\n    if(args[0] !== 'nodebug') {\n        $('body').append(`<div id=\"PMV_DIV\" style=\"font-family:monospace;overflow-y:scroll;height:450px;z-index:99999;font-size:12px;display:none;position:fixed; background:rgba(255,255,255,0.85);padding:5px;width:230px; color:#000; bottom:0px;right:0px;\">\n            </div>`);\n        let scope = null;\n        function toHHMMSS(sec) {\n            let sec_num = parseInt(sec, 10); // don't forget the second parm\n            let hours  = Math.floor(sec_num / 3600);\n            let minutes = Math.floor((sec_num - (hours * 3600)) / 60);\n            let seconds = sec_num - (hours * 3600) - (minutes * 60);\n\n            let Ohours = hours + '';\n            let Ominutes = minutes + '';\n            let Oseconds = seconds + '';\n            if (hours < 10) {\n                Ohours = \"0\" + hours;\n            }\n            if (minutes < 10) {\n                Ominutes = \"0\" + minutes;\n            }\n            if (seconds < 10) {\n                Oseconds = \"0\" + seconds;\n            }\n            var time = Ohours + ':' + Ominutes + ':' + Oseconds;\n            return time;\n        }\n        function parseFmt(str) {\n            let d = str.split(':');\n            return parseFloat(parseFloat(d[0].replace(/^0+/, '')||0)*60 + parseFloat(parseFloat(d[1].replace(/^0+/, '')||0)));\n        }\n        function asNumber(str) {\n            return str.indexOf(':') != -1 ? parseFmt(str) * 1000 : parseInt(str);\n        }\n        let timestamp = 0;\n        function appendPart(part, depth) {\n            try {\n                for(let p of part) {\n                    if(p.name === 'wait' || p.name === 'swait') {\n                        if(p.args == null) {\n                            $('#PMV_DIV').append('<div style=\"color:red\">[!] WAIT WITH EXPANDO</div>');\n                        } else {\n                            timestamp += asNumber(p.args[0])/1000;\n                        }\n                    } else if(p.name === 'songWait') {\n                        let d = asNumber(p.args[0])/1000;\n                        if(timestamp > d) {\n                            $('#PMV_DIV').append('<div style=\"color:red\">[!] BAD TIMESTAMP ('+(timestamp - d)+'s off)</div>');\n                        } else {\n                            timestamp = d;\n                        }\n                    }\n                    $('#PMV_DIV').append('<div data-ts=\"'+timestamp+'\">['+(p.name==='songWait'?('<a style=\"color:black\" href=\"#\" onclick=\"_jump('+timestamp+');return false\">'+toHHMMSS(timestamp)+'</a>'):toHHMMSS(timestamp))+'] '+(' &nbsp; '.repeat(depth))+p.name+'</div>');\n                    if(p.children) appendPart(p.children, depth+1);\n                    if(p.name !== 'swait' && state.scope[p.name] && state.scope[p.name].scoperef) {\n                        appendPart(state.scope[p.name].scoperef.children[0].children, depth+1);\n                    }\n                }\n            } catch(e) {\n                $('#PMV_DIV').append('<div style=\"color:red\">[!] '+e.message+'</div>');\n            }\n        }\n        window._jump = (ts) => {\n            if(state.scope.pmv && state.scope.pmv.song && state.scope.pmv.song.currentTime < ts) {\n                state.global.pmvTarget = ts;\n                app.skip();\n            }\n        };\n        appendPart(state.current.children, 0);\n        addEventListener('keydown', ev => {\n            if(ev.keyCode === 80) {\n                $('#PMV_DIV').toggle();\n            }\n        });\n        setInterval(() => {\n            $('[data-ts]').each(function() {\n                if(state && state.scope.pmv && state.scope.pmv.song) {\n                    if(state.scope.pmv.song.currentTime >= $(this).data('ts')) {\n                        $(this).css({color:'green', fontWeight:'bold'});\n                    }\n                }\n            });\n        }, 400);\n    }\n    next(() => {\n        state.scope.pmv = false;\n        state.scope.pmv.song = null;\n    });\n}\ncmd preload {\n    app.preloadMediaStep = () => {\n        app.preloadMediaStep = app.done;\n        next();\n    }\n    app.preloadMedia(args[0]);\n}\ncmd grid {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    if (args[0].indexOf('x') !== -1) {\n        let n = args[0].split('x');\n        args = [n[0], n[1]];\n    }\n    if (args[1]) {\n        app.setGrid(~~args[0], ~~args[1]);\n    } else app.setGrid(1, ~~args[0]);\n    next();\n}\ncmd softfade {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    app.transition = true;\n    next();\n}\ncmd hide {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    $('#grid_ivc'+args[0]).hide();\n    $('#grid_i'+args[0]).hide();\n    next();\n}\ncmd show {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    $('#grid_ivc'+args[0]).show();\n    $('#grid_i'+args[0]).show();\n    next();\n}\ncmd fadein {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    $('#grid_ivc'+args[0]).fadeIn(~~args[1]||1000);\n    $('#grid_i'+args[0]).fadeIn(~~args[1]||1000);\n    next();\n}\ncmd fadeout {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    $('#grid_ivc'+args[0]).fadeOut(~~args[1]||1000);\n    $('#grid_i'+args[0]).fadeOut(~~args[1]||1000);\n    next();\n}\ncmd video {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    if(state.global.pmvTarget && state.scope.pmv.song.currentTime < state.global.pmvTarget) {\n        next();\n        return;\n    }\n    let params = {\n        index: 0,\n        src: args[0],\n        bg: null,\n        fitMode: 'adjust',\n        endedCallback: null,\n        centerBackgroundVertically: true,\n        backgroundImageBlur: true,\n        startAt: 0,\n        loop: true,\n        volume: 1,\n    };\n    if (rawArgs.trim().startsWith('(')) {\n        params = Object.assign(params, eval(rawArgs));\n    }\n    app.setGridVideo(params.index, params.src, params.bg, params.fitMode, params.endedCallback, params.centerBackgroundVertically, params.backgroundImageBlur, params.startAt, params.loop, params.volume)\n    next();\n}\ncmd image {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    if(state.global.pmvTarget && state.scope.pmv.song.currentTime < state.global.pmvTarget) {\n        next();\n        return;\n    }\n    let params = {\n        index: 0,\n        src: args[0],\n        bg: null,\n        fitMode: 'adjust',\n        centerBackgroundVertically: true,\n        backgroundImageBlur: true,\n    };\n    if (rawArgs.trim().startsWith('(')) {\n        params = Object.assign(params, eval(rawArgs));\n    }\n    app.setGridImage(params.index, params.src, params.bg, params.fitMode, params.centerBackgroundVertically, params.backgroundImageBlur)\n    next();\n}\nfunc swait {\n    wait #{args[0]} true\n}\ncmd wait {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    if((state.scope.pmv.g && state.scope.pmv.gskip) || (state.global.pmvTarget && state.scope.pmv.song.currentTime < state.global.pmvTarget)) {\n        next();\n        return;\n    }\n    function parseFmt(str) {\n        let d = str.split(':');\n        return parseFloat(parseFloat(d[0].replace(/^0+/, '')||0)*60 + parseFloat(parseFloat(d[1].replace(/^0+/, '')||0)));\n    }\n    let duration = args[0].indexOf(':') != -1 ? parseFmt(args[0]) * 1000 : parseInt(args[0]);\n    var uid = ++app.uid;\n    if(args[1] != 'true') {\n        app.setProgressTimeout(duration || 1000);\n    }\n    let once;\n    let _next = () => {\n        if(once) return;\n        once = true; next();\n    };\n    var intv = setTimeout(() => {\n        app.popSkippable(uid);\n        _next();\n    }, duration || 1000);\n    app.setSkippable(uid, () => {\n        app.setProgressTimeout(0);\n        clearTimeout(intv);\n        if(state.scope.pmv.g) {\n            state.scope.pmv.gskip = true;\n        }\n        _next();\n    });\n}\ncmdg g {\n    let pmv = state.scope.pmv;\n    pmv.g = true;\n    if (!window.___G___) {\n        window.___G___ = true;\n        $('body').append(`<div id=\"G_DIV\" style=\"font-size:12px;display:none;position:fixed; background:rgba(255,255,255,0.85);padding:5px;width:200px; color:#000; top:0px;right:0px;\">\n            <div id=\"insideG\"></div>\n            <div id=\"gtoggle\"></div>\n            <br>\n            PRESS \"K\" TO TOGGLE SKIP ALL<br>\n            PRESS \"LSHIFT\" TO TOGGLE THIS PANEL\n        </div>`);\n        addEventListener('keydown', ev => {\n            if(!ev.ctrlKey && !ev.shiftKey && ev.keyCode === 75) {\n                pmv.g = !pmv.g;\n                if(!pmv.g) pmv.gskip = false;\n            }\n            if(ev.keyCode === 16) {\n                $('#G_DIV').toggle();\n            }\n        });\n        setInterval(() => {\n            $('#gtoggle').text($('#insideG').text().match('NO')?'--':(pmv.g?'SKIP ALL':'SKIP ONE'));\n        }, 200);\n    }\n    $('#insideG').html('Inside G: <b style=\"color:green\">YES</b>');\n    next(() => {\n        $('#insideG').html('Inside G: <b style=\"color:red\">NO</b>');\n        pmv.gskip = null;\n        pmv.g = null;\n    });\n}\ncmd queueVideo {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    let params = {\n        index: 0,\n        src: args[0],\n        bg: null,\n    };\n    if (rawArgs.trim().startsWith('(')) {\n        params = Object.assign(params, eval(rawArgs));\n    }\n    app.addGridVideoQueue(params.index, params.src, params.bg);\n    next();\n}\ncmd resetQueue {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    app.addGridVideoQueue(parseInt(args[0]), null, 'reset');\n\tnext();\n}\ncmd song {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    let song = new Audio();\n    song.src = args[0];\n    let once = false;\n    song.addEventListener('canplaythrough', function() { \n        if(once) return;\n        once = true;\n        song.play();\n        next();\n     }, false);\n     state.scope.pmv.song = song;\n}\ncmd songWait {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    if (!state.scope.pmv.song) throw new Error('No song playing!');\n    function parseFmt(str) {\n        let d = str.split(':');\n        return parseFloat(parseFloat(d[0].replace(/^0+/, '')||0)*60 + parseFloat(parseFloat(d[1].replace(/^0+/, '')||0)));\n    }\n    let position = args[0].indexOf(':') != -1 ? parseFmt(args[0]) * 1000 : parseInt(args[0]);\n    let duration = Math.max(0, Math.round(position - state.scope.pmv.song.currentTime * 1000));\n    if (state.debug) {\n        console.log('SONGWAIT TARGET=%d CURRENT=%d COMPUTED=%d', position, parseInt(state.scope.pmv.song.currentTime*1000), duration)\n    }\n    if (state.scope.pmv.g && state.scope.pmv.gskip || (state.global.pmvTarget && state.scope.pmv.song.currentTime < state.global.pmvTarget)) {\n        state.scope.pmv.song.currentTime = position / 1000;\n        next();\n        return;\n    }\n    state.global.pmvTarget = null;\n    var uid = ++app.uid;\n    if(args[1] != 'true') {\n        app.setProgressTimeout(duration);\n    }\n    let intv = setTimeout(() => {\n        app.popSkippable(uid);\n        next();\n    }, duration);\n    app.setSkippable(uid, () => {\n        if(state.scope.pmv.g) {\n            state.scope.pmv.gskip = true;\n        }\n        app.setProgressTimeout(0);\n        clearTimeout(intv);\n        state.scope.pmv.song.currentTime = position / 1000;\n        next();\n    });\n}\ncmd ifx {\n    if (!state.scope.pmv) throw new Error('Must be inside a PMV instance!');\n    let params = {\n        index: 0,\n        html: '',\n    };\n    if (rawArgs.trim().startsWith('(')) {\n        params = Object.assign(params, eval(rawArgs));\n    }\n    app.setGridFx(params.index, params.html);\n    next();\n}\nalias +video = queueVideo\nalias -video = resetQueue\nalias timestamp = songWait\n\n"}}();